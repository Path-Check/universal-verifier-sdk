const {verifyQRCode} = require('../lib/index');
const expect = require('chai').expect; 

const base32url = require('base32url');

const PRODUCTION_PAYLOAD = {
  "@context":["https://www.w3.org/2018/credentials/v1","https://cowin.gov.in/credentials/vaccination/v1"],
  "type":["VerifiableCredential","ProofOfVaccinationCredential"],
  "credentialSubject":{
    "type":"Person",
    "id":"did:Passport:Dummy256",
    "refId":"39791185041847",
    "name":"Third March User One",
    "gender":"Male",
    "age":"65",
    "nationality":"Indian",
    "address":{
      "streetAddress":"",
      "streetAddress2":"",
      "district":"Chamba",
      "city":"",
      "addressRegion":"Himachal",
      "addressCountry":"IN",
      "postalCode":176207
    }
  },
  "issuer":"https://cowin.gov.in/",
  "issuanceDate":"2021-03-03T04:28:46.012Z",
  "evidence":[{
    "id":"https://cowin.gov.in/vaccine/92047670169",
    "feedbackUrl":"https://cowin.gov.in/?92047670169",
    "infoUrl":"https://cowin.gov.in/?92047670169",
    "certificateId":"92047670169",
    "type":["Vaccination"],
    "batch":"Dummy-TGN-Chamba",
    "vaccine":"COVISHIELD",
    "manufacturer":"Serum Institute of India",
    "date":"2021-03-03T04:28:43.134Z",
    "effectiveStart":"2021-03-03",
    "effectiveUntil":"2021-03-03",
    "dose":1,
    "totalDoses":2,
    "verifier":{
      "name":"Dummy Vaccinator"
    },
    "facility":{
      "name":"Himachal Site Name 176207",
      "address":{
        "streetAddress":"Address Of Site 176207",
        "streetAddress2":"",
        "district":"Chamba",
        "city":"",
        "addressRegion":"Himachal",
        "addressCountry":"IN",
        "postalCode":""}
      }
    }
  ],
  "nonTransferable":"true",
  "proof":{
    "type":"RsaSignature2018",
    "created":"2021-03-03T04:28:46Z",
    "verificationMethod":"did:india",
    "proofPurpose":"assertionMethod",
    "jws":"eyJhbGciOiJQUzI1NiIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..nE-3iYDcKok-CmTm3pbpyZQheqpVDor_f0YQt4ukWDGyZuqtZuu8NROtJjOZ-LNAavN-JZtCAdunofe19-mcC2HC20W_yxzGfB1Idft15CruJWOuvkkKXX0UoezZhsk_Cd-HmeHeCCUgoyLiDtpSqzXd9WqiHG_XN39PUMvIHnZAPo54sodtzAEX88L1GSSd37JBrOlKoeMMJaC0JDIEDSFV-SaVk_vH5e06Vq86WrkMj5oj4pqmgnql7W_qt3NAgNqQQgUUNhsMOHwHXKBr5j80yjp1LRMidB81u0SQJvbxQVxLnphUbPcTI4h6nLJeZJjOiecOLESgIELpC2_SDg"
  }
};

// payload is actually binary, but we are representing here in B64
const PRODUCTION_PAYLOAD_B32URL = "KBFQGBAKAAAAACAAB7BKDQ4DKIFMHBGDSLB2FQ5EAMAABQ4ZA4AAAEAAAAAGGZLSORUWM2LDMF2GKLTKONXW5Q4NKROXHQ5KHAGMHPJLBTBY6CZEYOQ4FG6CS7BLWNGDWRBCQJGDSDB3AVOCSYO4HBRYJZRCA5WCWAOSRQ5NYO2MFP6CV7B2HQ4QII54HLODRTB25Q43YOHMHMCAYKSCGWKHHJJMHPTVYKK4HPYTKIRMHEGCWNMMHJK3P7BK3Q5SYKQRAMLPYKKUVQVHYOJ4FKLYFILSSC2KYKDMFJRXJLBJAIIPCHBIDQ4BYKPMFF6CR3B3UKWDX7BYOFIKYOUQTQUTMJAMFD2FJQ7MHIYAYKCMFGAAYKASSUJRP7BYWIDRYKHFDQ5WYOJAYMODVRR4FMGDTER4HMZDI3B2KHJRJJ64HB6CT5O4FI3PAFU4FEWDVMRW5QVSYOMSFQUYYOLMHPWDXLBJCW3GIDBIYU6CULBJEYKPLE6MHLGCWVDMFAGDWPBJQMWDSHB2UJCROQ3MFKRVAVQMHCGCW4ZEZQVZLFX4HKT2YKR4FKSVYO2ENQVFYKXMFHAEIRM4HBSJYKEMFGOCS4NQEBWDQPBZZQUUEPBJM4YIKLBIQAARB4Y4FBIZYKBH2ZQDIELFJQVLL3BJFQVEDTBYAHWCRPBLGMS3YOCMHAZAYKVQ46A6IPBJYZ6DUVZ4HAIQCLB22D6DSMVMFLZQYKP4HDGDQ3BZLQ5OMHB2TQ4BYKFMHOZKN7BIMIGDTIAGLQUHYOX4HL6DTTBL5Q5QYKEAFQU4OZCMFGT3HABDBQV4YO2MHOWDUI3GSQQEYK54FFDHFNHUZQVZAB54FE32FEL4FPK6GPBLJQ52YONVXQ42KDBY5QUTBPB2C3YFYKIHKXOCQIAMFAOCVABUJQ4WBJBTHQ5UYKBFNQUWYK74FCKWNEM4FDKWYKSVNQ4UORR4FKODSDB2RQUIYOSTRQVBYOJMHBODVPBYPQ4IYK7MHDOCTZEQVQUVYKNMFBSWYKU4HF6DVLBJUXTLYKVBIPSCYOPANQ4AYOO4FFGDVV7Q5Q56YO2TKCQTYKP4HPWCW4EMFCGCTDBJBQVKYKC4FEWDS5CTKXYRG4BMFPYKHDBJHQ5NAYEBRQVKEDBKLQ4AYOBMFJDLC5XAM56DUHBJNQ4NYOJ4FGKZN3BY7QV2D52MFFBLAISMHMIBCQE4FO6CWTBZ4RJMYKEXEFWDUEBMFC2EYKQBZQ5VONFFNQUZGJ7MHLT2YK44FKGCS4V4FF6CV3B3XQV6YOOBY7CEYKXAATD4YOAX6RSMYOS4FLWDVXBL6Q3YYKKCW6OCUTBLZQVJYKKEWR36YKT4HERVKI5GVQV7KXBL3QVPG7BJXQVEYKUMHJ6DTZ5UHQVFHNK4FFJEYKDS6C3SBN7MHF3KYOHMHBOCSLBKILODRXBLSTGCRLB36ZT3F3B3646CR3BJ7QUFYOPUJQ56D53CUTODW3B3NQ5WYKLAVQUDKAZGDQUAOAP4FMODWQPCVQVHMBEXMTODULB3IHD6HFYMFDY4YK4DRQUQYO64FE6CQJEMHD3TKYSEG4WDWDBZ4T6DXPBJMTJ5YKNQUVGCVIOCEEODSLB2W7ODQQPQEUSPYKHBEFTHYOR4FFOCSQ4E7QUFP4G4FEOCUDB22KLLGM5MHN6DQNGROYQHYO34HB6DSMLUXQVXYKY4HBOCVXBYQMTMYOJ4FKRNYKR4HHY4DJJ4HOLNYKP4HALCYKGMFHJ5YODU7Q43E7BY3Q42YOV4HDLCYKI4HHAXYOFMHOGCVEBR7Q5IYKXGARWCSPBKQHDPYORMHM3SDTBKEQZ4YOVVBQVWYO3MFNOCU7BLDQVIETBLW6OCU55V4JQHYKYUZQUSYKDMHPODVDBIRQ56YOLFSFQGOYNRZQ5NIJ7STQ4MYK3MFFYQYOVCHQV5LHBIRQVANHB3ITCDYKN4FL6DR7BY6L25YO7U5QVXHRP4HKCVYKJSLQ55YK44FEY4O7BLXQUHYOCUFQU3KLB3JQVSBTB3S3TNPLBIKXWCQR5MHCBUYKTQCPIPOBD4HBGDV3B2CZODUE24HJYHYOOMHK6CVYLXNQVZHHBJUDWCR5LMFDZMYONSGWWCVVYMHKWCRHBJPQ5WYO64FIWDSEMMHKC5YOL4HNODRLB3LQ56DVZ4HNQPCQG4FB35MBVMHPOCRZ24HH3RP7BY6CROYKMMHLODS3BYOXQVNHBLLQ4ZYKQVDQU3YKZ4HHLQLPBKLQ43JJ6MFCACOLBZRQ4XYOT4HK6CQMUMHG6DVXBYAPWCRTBYPQ4BORVMFB34YOUMHNCOYK64HBODQMO4FK3ODPBZU6I3YOV4FA6DQ4Q4HNWDVYNHVQVCYK44HI6DXZY4HMZ4YKPD2D2IDRHDOIZYYKYSUYOCRUGMHOTIFEN4FAIROQDMHN3OEBHUK3A2NPBLOE6CUTBKVQ4KYO7QGUCLAEBBIAAKAAAAACAAB7BKDQ4DKIFMHBGDSLB2FQ5EAMAABQ4ZA4AAAEAAAAAAAAAAAAAAAAAAAAAAAAAAABRWK4TUNFTGSY3BORSS42TTN5XFASYFAYAAAAAAAEAACAB6AAAAAEQEAAAAAAA"
    
describe('DIVOC QRs', function() {
  it('should Verify w/ Production Key', async () => {
    const result = await verifyQRCode(base32url.decodeAsString(PRODUCTION_PAYLOAD_B32URL));

    expect(JSON.parse(result)).to.eql(PRODUCTION_PAYLOAD);
  });
});